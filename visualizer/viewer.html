<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CLRS probe visualizer (v0.4)</title>
    <link rel="stylesheet" href="viewer.css" />
</head>
<body>
<header>
    <h2>CLRS probe visualizer</h2>
    <div class="small mono" id="topMeta"></div>
</header>

<div class="wrap">
    <div class="controls">
        <label>
            Load JSON:
            <input id="file" type="file" accept=".json" />
        </label>

        <div class="inline">
            <label style="flex:1; min-width: 160px;">
                Batch index:
                <input id="bidx" type="number" value="0" min="0" style="width: 150px;" />
            </label>
            <label style="flex:1; min-width: 160px;">
                FPS:
                <input id="fps" type="text" value="6" inputmode="decimal" style="width: 150px;" />
            </label>
        </div>

        <label>
            Time:
            <input id="t" type="range" min="0" max="0" value="0" step="1" />
            <span id="tLabel" class="mono"></span>
        </label>

        <div class="inline">
            <button id="play">Play</button>
            <button id="stepBack">&lt;</button>
            <button id="stepForward">&gt;</button>
            <button id="pause">Pause</button>
            <button id="all">All</button>
            <button id="none">None</button>
        </div>

        <div class="inline">
            <label style="flex:1; min-width: 160px;">
                Vector cell size:
                <input id="vcell" type="number" value="13" min="1" max="120" />
            </label>
            <label style="flex:1; min-width: 160px;">
                Matrix cell size:
                <input id="mcell" type="number" value="4" min="1" max="80" />
            </label>
        </div>

        <!-- Global matrix subrange selector -->
        <div class="inline">
            <label style="flex:1; min-width: 160px;">
                Rows [start,end):
                <div class="inline" style="gap:6px;">
                    <input id="r0" type="number" value="0" min="0" style="width:80px;" />
                    <input id="r1" type="number" value="0" min="0" style="width:80px;" />
                </div>
            </label>
            <label style="flex:1; min-width: 160px;">
                Cols [start,end):
                <div class="inline" style="gap:6px;">
                    <input id="c0" type="number" value="0" min="0" style="width:80px;" />
                    <input id="c1" type="number" value="0" min="0" style="width:80px;" />
                </div>
            </label>
        </div>

        <label>
            Contrast:
            <input id="contrast" type="range" min="0.2" max="6" value="1" step="0.1" />
            <span id="contrastLabel" class="mono"></span>
        </label>

        <label class="inline">
            <input id="lockScale" type="checkbox" checked />
            <span>Lock color scale across time</span>
        </label>

        <div class="legend small">
            <div class="swatch"></div>
            <div><span class="mono">white=0</span> â†’ <span class="mono">black=1</span></div>
        </div>

        <label>
            Probes to view:
            <div id="probeList" class="probeListBox small"></div>
        </label>

        <hr />
        <div>
          <div class="inline" style="align-items:center;">
            <label class="inline" style="margin: 6px 0;">
              <input id="showPca" type="checkbox" />
              <span>PCA: show trajectory of GNN hidden states</span>
            </label>
          </div>
          <div class="inline">
            <label style="flex:1; min-width: 130px;">
              PC for X-axis (1-based):
              <input id="pcx" type="number" value="1" min="1" style="width:88px;" />
            </label>
            <label style="flex:1; min-width: 130px;">
              PC for Y-axis (1-based):
              <input id="pcy" type="number" value="2" min="1" style="width:88px;" />
            </label>
          </div>
          <div class="small" id="pcaInfo" style="color:var(--muted);"></div>
        </div>

        <!-- Node-wise PCA panel -->
        <div>
          <div class="inline" style="align-items:center;">
            <label class="inline" style="margin: 6px 0;">
              <input id="showPcaNodes" type="checkbox" />
              <span>PCA: nodes at current time (basis from all times)</span>
            </label>
          </div>
          <div class="inline" style="align-items:center;">
            <label class="inline" style="margin: 6px 0;">
              <input id="colorGraphNodes" type="checkbox" />
              <span>Color graph nodes</span>
            </label>
          </div>
          <div class="inline">
            <label style="flex:1; min-width: 130px;">
              PC for X-axis (1-based):
              <input id="pcxNodes" type="number" value="1" min="1" style="width:88px;" />
            </label>
            <label style="flex:1; min-width: 130px;">
              PC for Y-axis (1-based):
              <input id="pcyNodes" type="number" value="2" min="1" style="width:88px;" />
            </label>
          </div>
          <div class="small" id="pcaNodesInfo" style="color:var(--muted);"></div>
        </div>

        <div class="hoverPanel">
            <div class="hoverTitle">Hover value</div>
            <div id="hoverText" class="hoverText mono">Hover any cell to see its value here.</div>
        </div>

        <div id="meta" class="small mono"></div>
    </div>

    <div class="main">
        <div class="toolbar">
            <div class="left small mono" id="algoName"></div>
            <div class="right small mono" id="summary"></div>
        </div>

        <div id="cardsContainer" class="cards"></div>
        <div id="pcaContainer" style="margin-top:16px; display:none;">
          <div class="small mono" id="pcaTitle" style="margin:6px 2px;">PCA trajectory</div>
          <canvas id="pcaCanvas" style="width:100%; height:320px; border:1px solid var(--border); border-radius:8px; background:#fff;"></canvas>
        </div>
        <div id="pcaNodesContainer" style="margin-top:16px; display:none;">
          <div class="small mono" id="pcaNodesTitle" style="margin:6px 2px;">PCA (nodes at current time)</div>
          <canvas id="pcaNodesCanvas" style="width:100%; height:320px; border:1px solid var(--border); border-radius:8px; background:#fff;"></canvas>
        </div>
    </div>
</div>

<script src="pca.js"></script>
<script src="viewer.js"></script>
</body>
</html>

